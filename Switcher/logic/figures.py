figures = {
    "I": [[2, 0, 0, 0, 0, 2], [0, 1, 1, 1, 1, 0], [2, 0, 0, 0, 0, 2]],
    "Long I": [[2, 0, 0, 0, 0, 0, 2], [0, 1, 1, 1, 1, 1, 0], [2, 0, 0, 0, 0, 0, 2]],
    "Square": [[2, 0, 0, 2], [0, 1, 1, 0], [0, 1, 1, 0], [2, 0, 0, 2]],
    "T": [[2, 0, 0, 0, 2], [0, 1, 1, 1, 0], [2, 0, 1, 0, 2], [2, 2, 0, 2, 2]],
    "Big T": [
        [2, 0, 0, 0, 2],
        [0, 1, 1, 1, 0],
        [2, 0, 1, 0, 2],
        [2, 0, 1, 0, 2],
        [2, 2, 0, 2, 2],
    ],
    "L": [[2, 0, 0, 0, 2], [0, 1, 1, 1, 0], [0, 1, 0, 0, 2], [2, 0, 2, 2, 2]],
    "L inverted": [[2, 0, 0, 0, 2], [0, 1, 1, 1, 0], [2, 0, 0, 1, 0], [2, 2, 2, 0, 2]],
    "Big L": [
        [2, 0, 0, 0, 0, 2],
        [0, 1, 1, 1, 1, 0],
        [0, 1, 0, 0, 0, 2],
        [2, 0, 2, 2, 2, 2],
    ],
    "Big L inverted": [
        [2, 0, 0, 0, 0, 2],
        [0, 1, 1, 1, 1, 0],
        [2, 0, 0, 0, 1, 0],
        [2, 2, 2, 2, 0, 2],
    ],
    "S": [[2, 2, 0, 0, 2], [2, 0, 1, 1, 0], [0, 1, 1, 0, 2], [2, 0, 0, 2, 2]],
    "Big S": [
        [2, 2, 0, 0, 2],
        [2, 0, 1, 1, 0],
        [2, 0, 1, 0, 2],
        [0, 1, 1, 0, 2],
        [2, 0, 0, 2, 2],
    ],
    "Big Z": [
        [2, 0, 0, 2, 2],
        [0, 1, 1, 0, 2],
        [2, 0, 1, 0, 2],
        [2, 0, 1, 1, 0],
        [2, 2, 0, 0, 2],
    ],
    "Z": [[2, 0, 0, 2, 2], [0, 1, 1, 0, 2], [2, 0, 1, 1, 0], [2, 2, 0, 0, 2]],
    "L-S": [
        [2, 2, 0, 0, 0, 2],
        [2, 0, 1, 1, 1, 0],
        [0, 1, 1, 0, 0, 2],
        [2, 0, 0, 2, 2, 2],
    ],
    "L-Z": [
        [2, 0, 0, 0, 2, 2],
        [0, 1, 1, 1, 0, 2],
        [2, 0, 0, 1, 1, 0],
        [2, 2, 2, 0, 0, 2],
    ],
    "Carpenter's square": [
        [2, 0, 0, 0, 2],
        [0, 1, 1, 1, 0],
        [0, 1, 0, 0, 2],
        [0, 1, 0, 2, 2],
        [2, 0, 2, 2, 2],
    ],
    "Left car": [
        [2, 0, 0, 0, 2],
        [0, 1, 1, 1, 0],
        [2, 0, 1, 1, 0],
        [2, 2, 0, 0, 2],
    ],
    "Right car": [
        [2, 0, 0, 0, 2],
        [0, 1, 1, 1, 0],
        [0, 1, 1, 0, 2],
        [2, 0, 0, 2, 2],
    ],
    "Croissant": [
        [2, 0, 0, 0, 2],
        [0, 1, 1, 1, 0],
        [0, 1, 0, 1, 0],
        [2, 0, 0, 0, 2],
    ],
    "Cross": [
        [2, 2, 0, 2, 2],
        [2, 0, 1, 0, 2],
        [0, 1, 1, 1, 0],
        [2, 0, 1, 0, 2],
        [2, 2, 0, 2, 2],
    ],
    "L-T": [
        [2, 2, 0, 2, 2],
        [2, 0, 1, 0, 2],
        [2, 0, 1, 1, 0],
        [0, 1, 1, 0, 2],
        [2, 0, 0, 2, 2],
    ],
    "L-T inverted": [
        [2, 2, 0, 2, 2],
        [2, 0, 1, 0, 2],
        [0, 1, 1, 0, 2],
        [2, 0, 1, 1, 0],
        [2, 2, 0, 0, 2],
    ],
    "L-I": [
        [2, 0, 0, 0, 0, 2],
        [0, 1, 1, 1, 1, 0],
        [2, 0, 1, 0, 0, 2],
        [2, 2, 0, 2, 2, 2],
    ],
    "L-I inverted": [
        [2, 0, 0, 0, 0, 2],
        [0, 1, 1, 1, 1, 0],
        [2, 0, 0, 1, 0, 2],
        [2, 2, 2, 0, 2, 2],
    ],
    "W": [
        [2, 0, 0, 0, 2],
        [0, 1, 1, 0, 2],
        [2, 0, 1, 1, 0],
        [2, 2, 0, 1, 0],
        [2, 2, 2, 0, 2],
    ],
}


class BoardFigure:
    def __init__(self, name, x, y, color):
        self.name = name
        self.x = x
        self.y = y
        self.color = color


figures_deck = []

for key in figures.keys():
    for _ in range(3):
        figures_deck.append(key)


def rotate_90(mat):
    return [list(row) for row in zip(*mat[::-1])]


def generate_variations(figure):
    variations = []
    current = figure
    for _ in range(4):
        current = rotate_90(current)
        # Check if the current variation is already in the list
        if current not in variations:
            variations.append(current)

    return variations


def match_at_position(matrix, figure, x, y, color_number):
    for i in range(len(figure)):
        for j in range(len(figure[0])):
            figure_value = figure[i][j]

            if figure_value == 2:
                continue
            elif figure_value == 0:
                if (
                    x + i < len(matrix)
                    and y + j < len(matrix[0])
                    and matrix[x + i][y + j] == color_number
                    and matrix[x + i][y + j] != 0
                    and matrix[x + i][y + j] != -1
                ):
                    return False
            elif (
                x + i >= len(matrix)
                or y + j >= len(matrix[0])
                or matrix[x + i][y + j] != color_number
            ):
                return False
    return True


def find_figure(matrix, figure_name, x, y, color_number):
    figure = figures[figure_name]
    variations = generate_variations(figure)
    for variation in variations:
        if match_at_position(matrix, variation, x, y, color_number):
            print(
                f"Figura {figure_name} encontrada en posición ({x}, {y}) con color {color_number}"
            )
            print(variation)
            return BoardFigure(figure_name, x, y, color_number)
    return None


def find_figures(matrix, color_number):
    board_figures = []
    for name, figure in figures.items():
        variations = generate_variations(figure)
        for x in range(len(matrix)):
            for y in range(len(matrix[0])):
                for variation in variations:

                    if match_at_position(matrix, variation, x, y, color_number):
                        # print(
                        #    f"Figura {name} encontrada en posición ({x}, {y}) con color {color_number}"
                        # )
                        # print(variation)
                        figure = BoardFigure(name, x, y, color_number)
                        board_figures.append(figure)
    return board_figures


def add_border_to_board(board):
    for i in range(len(board)):
        board[i].insert(0, -1)
        board[i].append(-1)
    board.insert(0, [-1] * len(board[0]))
    board.append([-1] * len(board[0]))
    return board


def check_figure_is_square(figure):
    for row in figure:
        assert len(row) == len(figure[0]), f"Figure is not square"


if __name__ == "__main__":
    import numpy as np

    # Ejemplo de uso
    board = [
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 2, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 1, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 0, 0, 0],
        [0, 3, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
    ]

    board = np.random.randint(0, 3, (12, 12)).tolist()

    playable_board = add_border_to_board(board)

    # print pretty board
    for row in playable_board:
        # switch -1 to X
        row = ["*" if cell == -1 else str(cell) for cell in row]
        print(" ".join(row))

    find_figures(board, 1)
